<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹ä¹ã‚¯ã‚¤ã‚º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Mochiy Pop One', sans-serif; /* ãƒãƒƒãƒ—ãªãƒ•ã‚©ãƒ³ãƒˆ */
            background-color: #f0f9ff; /* æ˜ã‚‹ã„æ°´è‰² */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        .quiz-container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 20px; /* è§’ã‚’ä¸¸ã */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        .question-area {
            font-size: 2.5rem; /* å•é¡Œã®æ–‡å­—ã‚’å¤§ãã */
            margin-bottom: 2rem;
            color: #2c5282; /* æ¿ƒã„é’è‰² */
            padding: 1rem;
            background-color: #ebf8ff; /* è–„ã„é’è‰²ã®èƒŒæ™¯ */
            border-radius: 10px;
        }
        .options button {
            font-size: 1.5rem; /* é¸æŠè‚¢ã®æ–‡å­—ã‚’å¤§ãã */
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .options button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .options button.correct-answer-style { /* æ­£è§£é¸æŠæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            background-color: #48bb78 !important; /* ç·‘è‰² */
            color: white !important;
            border-color: #38a169 !important;
        }
        .options button.wrong-answer-style { /* ä¸æ­£è§£é¸æŠæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            background-color: #f56565 !important; /* èµ¤è‰² */
            color: white !important;
            border-color: #c53030 !important;
        }
        .feedback {
            font-size: 1.8rem; /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ–‡å­—ã‚’å¤§ãã */
            margin-top: 1.5rem;
            min-height: 50px; /* é«˜ã•ã‚’ç¢ºä¿ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œã‚’é˜²ã */
        }
        .score {
            font-size: 1.2rem;
            margin-top: 1rem;
            color: #4a5568; /* ã‚„ã‚„æ¿ƒã„ç°è‰² */
        }
        .next-button {
            font-size: 1.2rem;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            background-color: #4299e1; /* é’è‰² */
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1.5rem;
        }
        .next-button:hover {
            background-color: #3182ce; /* å°‘ã—æ¿ƒã„é’è‰² */
        }
        .next-button:disabled {
            background-color: #a0aec0; /* ç°è‰² (éæ´»æ€§æ™‚) */
            cursor: not-allowed;
        }
        .options button.default-style {
            background-color: #63b3ed; /* é€šå¸¸æ™‚ã®é¸æŠè‚¢ã®è‰² (é’ç³») */
            color: white;
        }
        .options button.default-style:hover {
            background-color: #4299e1;
        }

        /* åŠ¹æœéŸ³ç”¨ã®éè¡¨ç¤ºè¦ç´  */
        .audio-container {
            display: none;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1 class="text-4xl font-bold mb-8 text-blue-700">ä¹ä¹ã‚¯ã‚¤ã‚ºãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</h1>
        
        <div id="question-area" class="question-area">
            </div>
        
        <div id="options" class="options grid grid-cols-1 gap-4">
            </div>
        
        <div id="feedback" class="feedback">
            </div>
        
        <div id="score" class="score">
            ã‚¹ã‚³ã‚¢: 0 / 0
        </div>
        
        <button id="next-button" class="next-button" disabled>ã¤ãã®ã‚‚ã‚“ã ã„ã¸</button>
    </div>

    <div class="audio-container">
        <audio id="correct-sound" src=""></audio> <audio id="wrong-sound" src=""></audio> </div>

    <script>
        const questionArea = document.getElementById('question-area');
        const optionsContainer = document.getElementById('options');
        const feedbackArea = document.getElementById('feedback');
        const scoreArea = document.getElementById('score');
        const nextButton = document.getElementById('next-button');
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');

        let currentQuestion = {};
        let score = 0;
        let questionsAttempted = 0;
        let answerSelected = false; // å›ç­”ãŒé¸æŠã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’è¿½è·¡

        // åŠ¹æœéŸ³ã®ç”Ÿæˆ (Tone.jsã®ä»£æ›¿ã¨ã—ã¦Data URIã‚’ä½¿ç”¨)
        function generateBeepDataURI(frequency = 440, duration = 0.1, type = "sine") {
            const sampleRate = 44100;
            const numSamples = Math.floor(sampleRate * duration);
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const buffer = audioContext.createBuffer(1, numSamples, sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < numSamples; i++) {
                const time = i / sampleRate;
                if (type === "sine") {
                    data[i] = Math.sin(2 * Math.PI * frequency * time) * 0.5; // æŒ¯å¹…ã‚’0.5ã«
                } else if (type === "square") {
                    data[i] = (Math.sin(2 * Math.PI * frequency * time) > 0 ? 1 : -1) * 0.3; // æŒ¯å¹…ã‚’0.3ã«
                } else if (type === "sawtooth") {
                    data[i] = (2 * (time * frequency - Math.floor(0.5 + time * frequency))) * 0.3; // æŒ¯å¹…ã‚’0.3ã«
                } else if (type === "triangle") {
                    data[i] = (2 * Math.abs(2 * (time * frequency - Math.floor(0.5 + time * frequency))) -1) * 0.3; // æŒ¯å¹…ã‚’0.3ã«
                }
            }
            
            // WAVãƒ˜ãƒƒãƒ€ãƒ¼ã®ä½œæˆ
            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };

            const bufferLength = buffer.length * 2; // 16-bit PCM
            const headerLength = 44;
            const totalLength = headerLength + bufferLength;
            const wavBuffer = new ArrayBuffer(totalLength);
            const view = new DataView(wavBuffer);

            writeString(view, 0, 'RIFF');
            view.setUint32(4, totalLength - 8, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // Subchunk1Size (16 for PCM)
            view.setUint16(20, 1, true);  // AudioFormat (1 for PCM)
            view.setUint16(22, 1, true);  // NumChannels (1 for mono)
            view.setUint32(24, sampleRate, true); // SampleRate
            view.setUint32(28, sampleRate * 2, true); // ByteRate (SampleRate * NumChannels * BitsPerSample/8)
            view.setUint16(32, 2, true);  // BlockAlign (NumChannels * BitsPerSample/8)
            view.setUint16(34, 16, true); // BitsPerSample (16-bit)
            writeString(view, 36, 'data');
            view.setUint32(40, bufferLength, true);

            // PCMãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿
            let offset = 44;
            for (let i = 0; i < buffer.length; i++, offset += 2) {
                const s = Math.max(-1, Math.min(1, data[i]));
                view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
            }
            
            const blob = new Blob([view], { type: 'audio/wav' });
            return URL.createObjectURL(blob);
        }

        // åŠ¹æœéŸ³ã‚’è¨­å®š
        correctSound.src = generateBeepDataURI(660, 0.2, "triangle"); // å°‘ã—é«˜ã‚ã®éŸ³
        wrongSound.src = generateBeepDataURI(220, 0.3, "sawtooth"); // ä½ã‚ã®ãƒ–ã‚¶ãƒ¼éŸ³


        function generateQuestion() {
            answerSelected = false; // æ–°ã—ã„å•é¡Œã§ãƒªã‚»ãƒƒãƒˆ
            const num1 = Math.floor(Math.random() * 9) + 1; // 1ã‹ã‚‰9ã¾ã§ã®æ•°
            const num2 = Math.floor(Math.random() * 9) + 1; // 1ã‹ã‚‰9ã¾ã§ã®æ•°
            const correctAnswer = num1 * num2;

            currentQuestion = {
                num1: num1,
                num2: num2,
                answer: correctAnswer
            };

            questionArea.textContent = `${num1} Ã— ${num2} = ?`;
            generateOptions(correctAnswer);
            feedbackArea.textContent = 'ã“ãŸãˆã¯ã©ã‚Œã‹ãªï¼Ÿ';
            feedbackArea.className = 'feedback text-gray-600'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«
            nextButton.disabled = true; // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
        }

        function generateOptions(correctAnswer) {
            optionsContainer.innerHTML = ''; // æ—¢å­˜ã®é¸æŠè‚¢ã‚’ã‚¯ãƒªã‚¢
            const options = new Set(); // é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã«Setã‚’ä½¿ç”¨
            options.add(correctAnswer);

            // ä¸æ­£è§£ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
            while (options.size < 3) {
                const num1 = Math.floor(Math.random() * 9) + 1;
                const num2 = Math.floor(Math.random() * 9) + 1;
                const wrongAnswer = num1 * num2;
                if (wrongAnswer !== correctAnswer) { // æ­£è§£ã¨ç•°ãªã‚‹å ´åˆã®ã¿è¿½åŠ 
                    options.add(wrongAnswer);
                }
            }

            // Setã‚’é…åˆ—ã«å¤‰æ›ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            const shuffledOptions = Array.from(options).sort(() => Math.random() - 0.5);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('default-style'); // é€šå¸¸æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«
                button.addEventListener('click', () => checkAnswer(option, button));
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(selectedAnswer, buttonElement) {
            if (answerSelected) return; // æ—¢ã«å›ç­”ãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
            answerSelected = true;

            questionsAttempted++;
            const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach(btn => btn.disabled = true); // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–

            if (selectedAnswer === currentQuestion.answer) {
                score++;
                feedbackArea.textContent = 'ğŸ‰ ãƒ”ãƒ³ãƒãƒ¼ãƒ³ï¼ã‚ãŸã‚Šï¼ ğŸ‰';
                feedbackArea.className = 'feedback text-green-500 font-bold';
                buttonElement.classList.remove('default-style');
                buttonElement.classList.add('correct-answer-style');
                if (correctSound.src) correctSound.play().catch(e => console.log("Audio play failed:", e));
            } else {
                feedbackArea.textContent = 'ğŸ˜¢ ã–ã‚“ã­ã‚“ï¼ã¯ãšã‚Œï¼ ğŸ˜¢';
                feedbackArea.className = 'feedback text-red-500 font-bold';
                buttonElement.classList.remove('default-style');
                buttonElement.classList.add('wrong-answer-style');
                if (wrongSound.src) wrongSound.play().catch(e => console.log("Audio play failed:", e));

                // æ­£è§£ã®é¸æŠè‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                allButtons.forEach(btn => {
                    if (parseInt(btn.textContent) === currentQuestion.answer) {
                        btn.classList.remove('default-style');
                        btn.classList.add('correct-answer-style');
                    }
                });
            }
            updateScore();
            nextButton.disabled = false; // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’æ´»æ€§åŒ–
        }

        function updateScore() {
            scoreArea.textContent = `ã‚¹ã‚³ã‚¢: ${score} / ${questionsAttempted}`;
        }

        nextButton.addEventListener('click', () => {
            if (!answerSelected && questionsAttempted > 0) return; // ã¾ã å›ç­”ã—ã¦ã„ãªã„å ´åˆã¯é€²ã‚ãªã„ï¼ˆåˆå›èµ·å‹•æ™‚ã‚’é™¤ãï¼‰
            generateQuestion();
             const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach(btn => {
                btn.disabled = false; // ãƒœã‚¿ãƒ³ã‚’å†åº¦æ´»æ€§åŒ–
                btn.className = 'options button default-style'; // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            });
        });

        // åˆæœŸå•é¡Œã®ç”Ÿæˆ
        generateQuestion();
    </script>
</body>
</html>
